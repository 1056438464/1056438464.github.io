<!DOCTYPE html>
<html>

<head>
  
  <title>百度语音demo | shang wj</title>
  <meta name="google-site-verification" content="" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta itemprop="name" content="shang wj" />
  <meta itemprop="description" content="" />
  <meta itemprop="image" content="" />
  <link rel="shortcut icon" href="" type="image/x-icon">
  <!-- keywords and description -->
  
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  
  
<link rel="stylesheet" href="/css/style.css">

  <script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
      onload="renderMathInElement(document.body);"></script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <div id="container">
    <header>
  <div class="site-title">
    <a href="/">
      shang wj
    </a>
  </div>
  
  
  <p class="links">
    
    <a href="">
      <img src="/images/links/" alt="">
    </a>
    
  </p>
  
</header>
    <div id="main">
      <article class="post">
  <h3 class="date">
  <time datetime="2018-05-09T02:07:00.000Z">
    May 9, 2018
  </time>
</h3>
  <h1>百度语音demo</h1>
  <p class="post-info">
  
  
  <a href="/2018/05/09/64/#waline" class="post-info-item comment-count waline-comment-count" id="/2018/05/09/64/">获取中...</a>
  <span class="post-info-item view-count waline-visitor-count" id="/2018/05/09/64/">获取中...</span>
  
</p>
  
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/error-info/" rel="tag">error_info</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/final/" rel="tag">final</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/import/" rel="tag">import</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/private/" rel="tag">private</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/string/" rel="tag">string</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/url2/" rel="tag">url2</a></li></ul>

  
  <article>
    <p>package com.fh.controller.tts;</p>
<span id="more"></span>
<p>import com.fh.controller.base.BaseController;<br>import com.fh.util.AppUtil;<br>import com.fh.util.PageData;<br>import com.fh.util.common.DemoException;<br>import com.fh.util.common.ConnUtil;<br>import com.fh.util.common.TokenHolder;<br>import com.mysql.fabric.Response;<br>import org.apache.http.HttpResponse;<br>import org.springframework.http.HttpRequest;<br>import org.springframework.stereotype.Controller;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.ResponseBody;</p>
<p>import javax.servlet.http.HttpServletResponse;<br>import java.io.*;<br>import java.net.HttpURLConnection;<br>import java.net.URL;<br>import java.util.HashMap;<br>import java.util.Map;</p>
<p>@Controller<br>@RequestMapping(value &#x3D; “&#x2F;api&#x2F;tts&#x2F;voice”)<br>public class TtsMain extends BaseController {</p>
<pre><code>//  填写网页上申请的appkey 如 $apiKey=&quot;g8eBUMSokVB1BHGmgxxxxxx&quot;
private final String appKey = &quot;4E1BG9lTnlSeIf1NQFlrSq6h&quot;;

// 填写网页上申请的APP SECRET 如 $secretKey=&quot;94dc99566550d87f8fa8ece112xxxxx&quot;
private final String secretKey = &quot;544ca4657ba8002e3dea3ac2f5fdd241&quot;;


// text 的内容为&quot;欢迎使用百度语音合成&quot;的urlencode,utf-8 编码
// 可以百度搜索&quot;urlencode&quot;
// private final String text = &quot;欢迎使用百度语音&quot;;

// 发音人选择, 0为普通女声，1为普通男生，3为情感合成-度逍遥，4为情感合成-度丫丫，默认为普通女声
private final int per = 0;
// 语速，取值0-9，默认为5中语速
private final int spd = 5;
// 音调，取值0-9，默认为5中语调
private final int pit = 5;
// 音量，取值0-9，默认为5中音量
private final int vol = 5;

public final String url = &quot;http://tsn.baidu.com/text2audio&quot;; // 可以使用https

private String cuid = &quot;1234567JAVA&quot;;

@RequestMapping(value = &quot;/text2audio.mp3&quot;)
private Object run(HttpServletResponse response
) throws IOException, DemoException &#123;

    PageData pd = new PageData();
    pd = this.getPageData();
    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
    int resultCode = 0;


    TokenHolder holder = new TokenHolder(appKey, secretKey, TokenHolder.ASR_SCOPE);
    holder.resfresh();
    String token = holder.getToken();
    if (pd.isValueNotEmpty(&quot;text&quot;) == false)&#123;

        map.put(&quot;error_info&quot;,&quot;text不能为空&quot;);
        resultCode= -1;

&#125; else &#123;

        String url2 = url + &quot;?tex=&quot; + ConnUtil.urlEncode(pd.getString(&quot;text&quot;));
        url2 += &quot;&amp;per=&quot; + per;
        url2 += &quot;&amp;spd=&quot; + spd;
        url2 += &quot;&amp;pit=&quot; + pit;
        url2 += &quot;&amp;vol=&quot; + vol;
        url2 += &quot;&amp;cuid=&quot; + cuid;
        url2 += &quot;&amp;tok=&quot; + token;
        url2 += &quot;&amp;lan=zh&amp;ctp=1&quot;;
        // System.out.println(url2); // 反馈请带上此url，浏览器上可以测试
        HttpURLConnection conn = (HttpURLConnection) new URL(url2).openConnection();
        conn.setConnectTimeout(5000);
        String contentType = conn.getContentType();
        if (contentType.contains(&quot;mp3&quot;)) &#123;
            byte[] bytes = ConnUtil.getResponseBytes(conn);

            OutputStream out = response.getOutputStream();
            out.write(bytes);
            out.flush();
            out.close();

        &#125;
    &#125;

    map.put(&quot;result_code&quot;,resultCode);
    return AppUtil.returnObject(new PageData(),map);
&#125;
</code></pre>
<p>}</p>

  </article>
  
  <hr>
  <blockquote>
    <p>
      本文由 <a href="">shang wj</a> 创作，采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0</a> 国际许可协议。
    </p>
    <p>
      本站文章除注明转载/出处外，均为本站原创或翻译，转载请务必署名。
    </p>
  </blockquote>
  
</article>


<div id="waline"></div>

    </div>
  </div>
  <footer>
  
  
  <p id="busuanzi_container_site_pv">
    本站访问量 <span id="busuanzi_value_site_pv">获取中...</span>
  </p>
  
  <p>
    Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/syy11cn/hexo-theme-linear">Linear</a> from <a target="_blank" rel="noopener" href="https://syy11.cn">Yiyang Sun</a>
  </p>
</footer>
  
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <script>
    Waline({
      el: '#waline',
      placeholder: '',
      avatar: 'retro',
      visitor: true,
      requiredFields: ['nick', 'mail'],
      serverURL: '',
      emoji: [
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/alus',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tw-emoji',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo',
        'https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba',
      ]
    });
  </script>
</body>

</html>